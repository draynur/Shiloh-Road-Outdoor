# Plan: Generate ACF JSON for Admin-Editable Field Groups

## Context

All 6 ACF field groups are registered programmatically via `acf_add_local_field_group()` in `inc/acf-field-groups.php`. Programmatically registered ("local") fields are **read-only** in the ACF admin editor. The goal is to migrate them to ACF Local JSON so they become editable in the admin UI while staying version-controlled in git.

## Approach: ACF Local JSON via WP-CLI Export

Use ACF's own `acf_prepare_field_group_for_export()` function to generate the JSON files — this guarantees perfect format compliance without hand-crafting JSON.

## Steps

### 1. Create `acf-json/` directory
```
mkdir acf-json/
```

### 2. Export field groups via `lando wp eval`

Run a WP-CLI script that reads the currently-registered PHP field groups and writes them as JSON using ACF's export utilities:

```bash
lando wp eval '
$groups = acf_get_local_field_groups();
$path = get_stylesheet_directory() . "/acf-json";
if (!is_dir($path)) mkdir($path, 0755);
foreach ($groups as $group) {
    $group["fields"] = acf_get_fields($group);
    $group = acf_prepare_field_group_for_export($group);
    $group["modified"] = time();
    file_put_contents(
        $path . "/" . $group["key"] . ".json",
        acf_json_encode($group) . PHP_EOL
    );
}
echo "Exported " . count($groups) . " field groups.\n";
'
```

This must run **before** disabling the PHP registration (it reads from those local groups).

Expected output: 6 JSON files in `acf-json/`:
- `group_sro_general.json`
- `group_sro_hero.json`
- `group_sro_highlights.json`
- `group_sro_subscribe.json`
- `group_sro_story_fields.json`
- `group_sro_author_fields.json`

### 3. Disable programmatic registration

Edit `inc/acf-field-groups.php` — add an early return when `acf-json/` exists:

```php
// If Local JSON is active, skip programmatic registration.
if ( is_dir( SRO_THEME_DIR . '/acf-json' ) ) {
    return;
}
```

Keep the existing PHP code intact as a fallback.

### 4. Sync to database

In the WP admin, go to **ACF > Field Groups** — the 6 groups will show a "Sync" indicator. Select all and click **Sync**.

Or via CLI: `lando wp acf sync --all` (if available in ACF Pro 6.7+).

### 5. Verify

- All 6 field groups are editable in ACF > Field Groups
- Theme options pages (General, Hero, Highlights, Subscribe) display fields correctly
- Story and Author edit screens show their ACF metaboxes
- Front-end renders correctly with existing data

## Files Modified
- **`inc/acf-field-groups.php`** — add early-return guard (keep existing code as fallback)
- **`acf-json/` (new)** — 6 JSON files generated by ACF export

## Files NOT Modified
- **`inc/acf-options-page.php`** — options pages must stay as PHP registration (they are separate from field groups)
- **`functions.php`** — no changes needed

## Important Notes
- Field **values** (stored in `wp_options` / `wp_postmeta`) are keyed by field `name`, not `key` — no data loss risk
- After setup, the workflow becomes: edit fields in admin → ACF auto-saves JSON → commit JSON to git
- The `acf-json/` directory must be writable by the web server (Lando handles this)

## Quick Reference

- **Theme dir**: `wordpress/wp-content/themes/shiloh-rd-outdoor/`
- **Dev server**: `cd wordpress && lando start`, then `npm run dev` in theme dir
- **Build CSS**: `npm run build` in theme dir
- **WP-CLI**: `lando wp theme activate shiloh-rd-outdoor`

## Seed Data Needed

1. 3 authors (Maris Caldwell, Jae Park, Owen Rios) via Stories > Authors
2. 5 stories with ACF fields (author, read time, location, featured flag)
3. 6 story tags: Camp, Field Notes, Gear, Hiking, Minimal, Navigation, Packing, Reflection, Ridge Roads, Ritual, Rivers, Slow Travel, Technique, Wet Weather, Winter Light
4. Upload hero + 3 feature images as featured images
5. Set front page display to "A static page" in Settings > Reading (select any page)
6. Fill in Theme Settings > Hero Section values (or use defaults)
7. Fill in Theme Settings > Highlights repeater (or defaults will render)
